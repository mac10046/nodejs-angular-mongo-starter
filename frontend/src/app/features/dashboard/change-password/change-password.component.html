<app-navbar></app-navbar>

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-6">
      <div class="dashboard-card">
        <h2 class="mb-4">Change Password</h2>

        @if (isGoogleOnly) {
        <div class="alert alert-info">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-2">
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="16" x2="12" y2="12" />
            <line x1="12" y1="8" x2="12.01" y2="8" />
          </svg>
          You signed up with Google. Setting a password will allow you to also login with email and password.
        </div>
        }

        <!-- Error Alert -->
        @if (errorMessage) {
        <div class="alert alert-danger" role="alert">
          {{ errorMessage }}
        </div>
        }

        <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()">
          @if (!isGoogleOnly) {
          <div class="mb-3">
            <label for="currentPassword" class="form-label">Current Password</label>
            <div class="password-input-wrapper">
              <input
                [type]="showCurrentPassword ? 'text' : 'password'"
                class="form-control"
                id="currentPassword"
                formControlName="currentPassword"
                placeholder="Enter current password"
                [class.is-invalid]="f['currentPassword'].touched && f['currentPassword'].invalid"
              />
              <button type="button" class="password-toggle" (click)="toggleCurrentPassword()">
                @if (showCurrentPassword) {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" />
                  <line x1="1" y1="1" x2="23" y2="23" />
                </svg>
                } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                  <circle cx="12" cy="12" r="3" />
                </svg>
                }
              </button>
            </div>
            @if (f['currentPassword'].touched && f['currentPassword'].errors) {
            <div class="invalid-feedback d-block">Current password is required</div>
            }
          </div>
          }

          <div class="mb-3">
            <label for="newPassword" class="form-label">New Password</label>
            <div class="password-input-wrapper">
              <input
                [type]="showNewPassword ? 'text' : 'password'"
                class="form-control"
                id="newPassword"
                formControlName="newPassword"
                placeholder="Enter new password"
                [class.is-invalid]="f['newPassword'].touched && f['newPassword'].invalid"
              />
              <button type="button" class="password-toggle" (click)="toggleNewPassword()">
                @if (showNewPassword) {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" />
                  <line x1="1" y1="1" x2="23" y2="23" />
                </svg>
                } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                  <circle cx="12" cy="12" r="3" />
                </svg>
                }
              </button>
            </div>
            @if (f['newPassword'].touched && f['newPassword'].errors) {
            <div class="invalid-feedback d-block">
              @if (f['newPassword'].errors['required']) { New password is required } @else if
              (f['newPassword'].errors['minlength']) { Password must be at least 8 characters } @else if
              (f['newPassword'].errors['pattern']) { Password must contain at least one uppercase letter, one lowercase
              letter, and one number }
            </div>
            }
          </div>

          <div class="mb-4">
            <label for="confirmPassword" class="form-label">Confirm New Password</label>
            <div class="password-input-wrapper">
              <input
                [type]="showConfirmPassword ? 'text' : 'password'"
                class="form-control"
                id="confirmPassword"
                formControlName="confirmPassword"
                placeholder="Confirm new password"
                [class.is-invalid]="f['confirmPassword'].touched && f['confirmPassword'].invalid"
              />
              <button type="button" class="password-toggle" (click)="toggleConfirmPassword()">
                @if (showConfirmPassword) {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24" />
                  <line x1="1" y1="1" x2="23" y2="23" />
                </svg>
                } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                  <circle cx="12" cy="12" r="3" />
                </svg>
                }
              </button>
            </div>
            @if (f['confirmPassword'].touched && f['confirmPassword'].errors) {
            <div class="invalid-feedback d-block">
              @if (f['confirmPassword'].errors['required']) { Please confirm your password } @else if
              (f['confirmPassword'].errors['passwordMismatch']) { Passwords do not match }
            </div>
            }
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-primary" [disabled]="isLoading">
              @if (isLoading) {
              <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              Changing...
              } @else { Change Password }
            </button>
            <a routerLink="/dashboard" class="btn btn-outline-secondary">Cancel</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
